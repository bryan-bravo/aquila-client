<h3>Timeline</h3>
<ul id='timeline-bar'>
  <li *ngFor='let stage of timeline?.stages; index as i'>
    <!-- bar -->
    <div class='bar' *ngIf='i!=0' (drop)='drop({"event":$event,"index":i})' (dragover)='allowDrop($event)'></div>
    <div class='icon-name-container' (click)='getCurrentStage(stage.id)'>
      <!-- icon -->
      <div class='icon'></div>
      <!-- name -->
      <label class='name'>{{stage.name}}</label>
    </div>

  </li>
  <button (click)='handleAddStage()'>Add Stage</button>

</ul>
<div id='stage-content'>
  <!-- view basic timeline info -->
  <div class='form-flex-start' *ngIf='dialogType=="view-basic-timeline"'>
    <h3>{{timeline.proposalName}}</h3>
    <label>Principal Investigator</label>
    <p>{{timeline.principalInvestigator}}</p>
    <label>Other Investigators</label>
    <p *ngFor='let oi of timeline.coPi'>{{oi}}</p>
    <label>Funding Agency</label>
    <p>{{timeline.fundingAgency }}</p>
    <label>UAS Due Date</label>
    <p>{{timeline.uasDueDate }}</p>
    <label>Sponsor Due Date</label>
    <p>{{timeline.sponsorDueDate }}</p>
    <label>Final Signatures Deadline</label>
    <p>{{timeline.finalSign}}</p>
    <button class='button-blue' (click)='setDialogType("edit-basic-timeline")'>Edit</button>
  </div>
  <!-- edit timeline info -->
  <div class='form-flex-start' *ngIf='dialogType=="edit-basic-timeline"'>
    <h3>{{timeline.proposalName}}</h3>
    <label>Principal Investigator</label>
    <p>{{timeline.principalInvestigator}}</p>
    <label>Other Investigators</label>
    <p *ngFor='let oi of timeline.coPi'>{{oi}}</p>
    <label>Funding Agency</label>
    <input type='text' pInputText [(ngModel)]='timeline.fundingAgency'>
    <label>UAS Due Date</label>
    <p-calendar [(ngModel)]='timeline.uasDueDate'></p-calendar>
    <label>Sponsor Due Date</label>
    <p-calendar [(ngModel)]='timeline.sponsorDueDate'></p-calendar>
    <label>Final Signatures Deadline</label>
    <p-calendar [(ngModel)]='timeline.finalSign'></p-calendar>
    <button class='button-blue' (click)='saveTimeline()'>Save Timeline</button>
  </div>
  <!-- show a stage -->
  <div class='form-flex-start' *ngIf='dialogType=="view-stage"'>
    <h2>{{stage.name}}</h2>
    <label>Expected Date</label>
    <label>{{stage.expectedDate}}</label>
    <label>Completed Date</label>
    <label>{{stage.completedDate}}</label>
      <p-dataTable [value]='stage.requiredForms'>
        <p-header>Required Forms</p-header>
        <p-column field='key' header='Form'></p-column>
        <p-column header='Status'></p-column>
      </p-dataTable>
      <p-dataTable [value]='stage.requiredFiles'>
        <p-header>Required Files</p-header>
        <p-column field='key' header='File'></p-column>
        <p-column header='Upload'>
          <ng-template pTemplate='body'>
            <input type='file'>
          </ng-template>
        </p-column>
        <p-column field='value' header='Download'>
          <ng-template pTemplate='body'>
            Download
          </ng-template>
        </p-column>
      </p-dataTable>
    <label class='stage-title'>Additional Notes</label>
    <p>{{stage.additionalNotes}}</p>

    <button class='button-blue' (click)='setDialogType("edit-stage")'>Edit</button>
  </div>
  <!-- edit a stage -->
  <div class='form-flex-start window' *ngIf='dialogType=="edit-stage"'>
    <h2>{{stage.name}}</h2>
    <input type='text' pInputText [(ngModel)]='stage.name'>
    <label>Expected Date</label>
    <p-calendar [(ngModel)]='stage.expectedDate' [showIcon]='true'></p-calendar>
    <label>Completed Date</label>
    <p-calendar [(ngModel)]='stage.completedDate' [showIcon]='true'></p-calendar>
    <label>UAS Review Required</label>
    <input type='checkbox'>
    <label>UAS Approved</label>
    <input type='checkbox'>
    <!-- forms -->
      <p-dataTable [value] = 'stage.requiredForms' [immutable]='false'>
          <p-header>Required Forms</p-header>
          <p-column field='key' header='Form'></p-column>
          <p-column header='Status'></p-column>
          <p-column header = 'Delete'>
            <ng-template pTemplate='body'>
              <button class='button-red' (click) = 'handleRemoveForm(key)'>Remove</button>
            </ng-template>
          </p-column>
          <p-footer>
              <select #form>
                  <option *ngFor='let form of unSelectedForms'>{{form}}</option>
                </select>
                <button class='button-blue' (click)='handleAddForm(form.value)'> Add Form</button>
          </p-footer>
        </p-dataTable>
        <!-- files -->
      <p-dataTable [value]='stage.requiredFiles' [immutable]='false'>
          <p-header>Required Files</p-header>
          <p-column field='key' header='File'></p-column>
          <p-column header='Upload'>
            <ng-template pTemplate='body'>
              <input type='file'>
            </ng-template>
          </p-column>
          <p-column field='value' header='Download'>
            <ng-template pTemplate='body'>
              Download
            </ng-template>
          </p-column>
          <p-column field='key' header='Delete'>
              <ng-template pTemplate='body'>
                  <button class='button-red' (click)='handleRemoveFile(key)'>Remove</button>
                </ng-template>
            </p-column>
            <p-footer>            
                <input type='text' #addReqFile>
                <button class='button-blue' (click)='handleAddFile(addReqFile.value)'>Add File</button>
            </p-footer>
        </p-dataTable>
    <label class='stage-title'>Additional Notes</label>
    <textarea pInputTextarea [(ngModel)]="stage.additionalNotes" autoResize="autoResize"></textarea>
    <label class='stage-title'>Order in Timeline</label>
    <label draggable='true'>Drag me to reorder</label>
    <button class='button-blue' (click)='saveStage()'> Save </button>
    <button class='button-red' (click)='deleteStage()'> Delete</button>
  </div>
</div>
